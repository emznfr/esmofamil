<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Nom & PrÃ©nom</title>

  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;margin:0;background:#f6f7fb}
    .wrap{max-width:1000px;margin:0 auto;padding:14px}
    .card{background:#fff;border-radius:16px;padding:14px;box-shadow:0 6px 18px rgba(0,0,0,.06);margin-bottom:12px}
    h1{margin:0 0 10px;font-size:20px}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row>*{flex:1;min-width:160px}
    input,button{width:100%;padding:10px 12px;border-radius:12px;border:1px solid #e5e7eb;font-size:14px}
    button{border:none;background:#2563eb;color:#fff;font-weight:800;cursor:pointer}
    button.secondary{background:#eef2ff;color:#1e3a8a}
    button.danger{background:#ef4444}
    .muted{color:#6b7280;font-size:12px}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#f1f5ff;color:#1e3a8a;font-weight:900;font-size:12px}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    @media(max-width:600px){.grid{grid-template-columns:1fr}}
    .answers{display:flex;flex-direction:column;gap:8px}
    .answer{border:1px solid #e5e7eb;border-radius:12px;padding:10px;background:#fbfdff}
    .meta{font-weight:900;margin-bottom:6px}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid #eef2f7;padding:8px;font-size:14px;text-align:left}
    .langbar{display:flex;gap:6px}
    .langbar button{padding:6px 10px;font-size:12px}
  </style>
</head>

<body>
<div class="wrap">

  <!-- Language selector -->
  <div class="card">
    <div class="langbar">
      <button class="secondary" onclick="setLang('fr')">ğŸ‡«ğŸ‡· FranÃ§ais</button>
      <button class="secondary" onclick="setLang('en')">ğŸ‡¬ğŸ‡§ English</button>
      <button class="secondary" onclick="setLang('fa')">ğŸ‡®ğŸ‡· ÙØ§Ø±Ø³ÛŒ</button>
    </div>
  </div>

  <div class="card">
    <h1 id="title"></h1>
    <div class="row">
      <input id="name" />
      <input id="code" />
    </div>
    <div class="row" style="margin-top:8px">
      <button id="createBtn"></button>
      <button id="joinBtn" class="secondary"></button>
    </div>
    <div class="muted" id="status" style="margin-top:8px">â€”</div>
  </div>

  <div class="card">
    <div class="row">
      <button id="startBtn" class="secondary"></button>
      <button id="endBtn" class="danger"></button>
    </div>
    <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
      <span class="pill">Room: <span id="roomCode">â€”</span></span>
      <span class="pill">Status: <span id="roomStatus">â€”</span></span>
      <span class="pill">Letter: <span id="roomLetter">â€”</span></span>
      <span class="pill">Submissions: <span id="subCount">0</span></span>
    </div>
  </div>

  <div class="card">
    <h1 id="answersTitle"></h1>
    <div class="grid" id="formGrid"></div>
    <div class="row" style="margin-top:10px">
      <button id="submitBtn"></button>
    </div>
    <div class="muted" id="submitMsg"></div>
  </div>

  <div class="card">
    <h1 id="allAnswersTitle"></h1>
    <div class="answers" id="answersList"></div>
  </div>

  <div class="card">
    <h1 id="scoresTitle"></h1>
    <table>
      <thead>
        <tr>
          <th id="thPlayer"></th>
          <th id="thTotal"></th>
          <th id="thRound"></th>
        </tr>
      </thead>
      <tbody id="scoresBody"></tbody>
    </table>
  </div>

</div>

<script src="/socket.io/socket.io.js"></script>
<script>
/* ================= I18N ================= */
const I18N = {
  fr: {
    title: "Nom & PrÃ©nom",
    name: "Votre prÃ©nom",
    code: "Code de la salle",
    create: "CrÃ©er la salle",
    join: "Rejoindre",
    start: "DÃ©marrer la manche",
    end: "Finir la manche",
    answers: "Vos rÃ©ponses",
    allAnswers: "RÃ©ponses de tous les joueurs",
    submit: "Envoyer mes rÃ©ponses",
    scores: "Scores",
    thPlayer: "Joueur",
    thTotal: "Total",
    thRound: "Manche",
    categories: {
      name: "PrÃ©nom",
      family: "Nom",
      city: "Ville",
      country: "Pays",
      animal: "Animal",
      food: "Nourriture",
      fruit: "Fruit",
      object: "Objet",
      color: "Couleur",
      job: "MÃ©tier",
    }
  },
  en: {
    title: "Name Game",
    name: "Your name",
    code: "Room code",
    create: "Create room",
    join: "Join",
    start: "Start round",
    end: "End round",
    answers: "Your answers",
    allAnswers: "All players answers",
    submit: "Submit answers",
    scores: "Scores",
    thPlayer: "Player",
    thTotal: "Total",
    thRound: "Round",
    categories: {
      name: "First name",
      family: "Last name",
      city: "City",
      country: "Country",
      animal: "Animal",
      food: "Food",
      fruit: "Fruit",
      object: "Object",
      color: "Color",
      job: "Job",
    }
  },
  fa: {
    title: "Ø§Ø³Ù… Ùˆ ÙØ§Ù…ÛŒÙ„",
    name: "Ù†Ø§Ù… Ø´Ù…Ø§",
    code: "Ú©Ø¯ Ø§ØªØ§Ù‚",
    create: "Ø³Ø§Ø®Øª Ø§ØªØ§Ù‚",
    join: "ÙˆØ±ÙˆØ¯",
    start: "Ø´Ø±ÙˆØ¹ Ø¯ÙˆØ±",
    end: "Ù¾Ø§ÛŒØ§Ù† Ø¯ÙˆØ±",
    answers: "Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§",
    allAnswers: "Ù¾Ø§Ø³Ø® Ù‡Ù…Ù‡ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†",
    submit: "Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§",
    scores: "Ø§Ù…ØªÛŒØ§Ø²Ù‡Ø§",
    thPlayer: "Ø¨Ø§Ø²ÛŒÚ©Ù†",
    thTotal: "Ú©Ù„",
    thRound: "Ø¯ÙˆØ±",
    categories: {
      name: "Ø§Ø³Ù…",
      family: "ÙØ§Ù…ÛŒÙ„",
      city: "Ø´Ù‡Ø±",
      country: "Ú©Ø´ÙˆØ±",
      animal: "Ø­ÛŒÙˆØ§Ù†",
      food: "ØºØ°Ø§",
      fruit: "Ù…ÛŒÙˆÙ‡",
      object: "Ø§Ø´ÛŒØ§Ø¡",
      color: "Ø±Ù†Ú¯",
      job: "Ø´ØºÙ„",
    }
  }
};

let lang = "fr";

/* ================= SOCKET ================= */
const socket = io();
const el = Object.fromEntries(
  ["title","name","code","createBtn","joinBtn","status","startBtn","endBtn",
   "roomCode","roomStatus","roomLetter","subCount",
   "answersTitle","formGrid","submitBtn","submitMsg",
   "allAnswersTitle","answersList","scoresTitle","scoresBody",
   "thPlayer","thTotal","thRound"
  ].map(id => [id, document.getElementById(id)])
);

let roomState = null;
let currentCode = null;

function setLang(l){
  lang = l;
  const t = I18N[lang];

  el.title.textContent = t.title;
  el.name.placeholder = t.name;
  el.code.placeholder = t.code;
  el.createBtn.textContent = t.create;
  el.joinBtn.textContent = t.join;
  el.startBtn.textContent = t.start;
  el.endBtn.textContent = t.end;
  el.answersTitle.textContent = t.answers;
  el.allAnswersTitle.textContent = t.allAnswers;
  el.submitBtn.textContent = t.submit;
  el.scoresTitle.textContent = t.scores;
  el.thPlayer.textContent = t.thPlayer;
  el.thTotal.textContent = t.thTotal;
  el.thRound.textContent = t.thRound;

  if(roomState?.categories) renderForm(roomState.categories);
}

function renderForm(categories){
  el.formGrid.innerHTML = "";
  categories.forEach(cat=>{
    const label = I18N[lang].categories[cat] || cat;
    el.formGrid.insertAdjacentHTML("beforeend", `
      <div>
        <div class="muted">${label}</div>
        <input id="cat_${cat}" placeholder="${label}..." />
      </div>
    `);
  });
}

socket.on("room:state", (state)=>{
  roomState = state;
  currentCode = state.code;
  el.roomCode.textContent = state.code || "â€”";
  el.roomStatus.textContent = state.status || "â€”";
  el.roomLetter.textContent = state.letter || "â€”";
  el.subCount.textContent = state.submissionsCount || 0;
  if(state.categories) renderForm(state.categories);
});

setLang("fr");
</script>
</body>
</html>
